<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comissões Parcerias</title>
    <link rel="icon" href="https://raw.githubusercontent.com/sejafibra/cupons/refs/heads/main/faviconsf.ico" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <style>
        .auth-container {
            max-width: 400px;
            margin: 0 auto;
            padding-top: 50px;
        }
        .main-container {
            padding: 20px;
        }
        .nav-tabs {
            margin-bottom: 20px;
        }
        .table-responsive {
            margin-top: 20px;
        }
        .logout-btn {
            position: absolute;
            top: 10px;
            right: 10px;
        }
        .total-row {
            font-weight: bold;
            background-color: #f8f9fa !important;
        }
        .admin-only {
            display: none;
        }
        .is-admin .admin-only {
            display: block;
        }
        .is-admin .admin-tab {
            display: list-item;
        }
    </style>
</head>
<body>
    <!-- Autenticação -->
    <div id="auth-container" class="auth-container">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title text-center">Login</h5>
                <div class="mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="email" placeholder="seu@email.com">
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">Senha</label>
                    <input type="password" class="form-control" id="password" placeholder="Sua senha">
                </div>
                <button id="login-btn" class="btn btn-primary w-100">Entrar</button>
                <div id="login-message" class="mt-3 text-center text-danger"></div>
            </div>
        </div>
    </div>

    <!-- Aplicação Principal (visível após login) -->
    <div id="app-container" class="main-container" style="display: none;">
        <button id="logout-btn" class="btn btn-danger logout-btn">Sair</button>
        <h2 class="text-center mb-4">Gerenciamento de Comissões</h2>
        
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item admin-tab" role="presentation" style="display: none;">
                <button class="nav-link active" id="partners-tab" data-bs-toggle="tab" data-bs-target="#partners" type="button" role="tab">Parceiros</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="contracts-tab" data-bs-toggle="tab" data-bs-target="#contracts" type="button" role="tab">Contratos</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="reports-tab" data-bs-toggle="tab" data-bs-target="#reports" type="button" role="tab">Relatórios</button>
            </li>
        </ul>
        
        <div class="tab-content" id="myTabContent">
            <!-- Aba de Parceiros -->
            <div class="tab-pane fade show active" id="partners" role="tabpanel">
                <h4>Cadastro de Parceiros</h4>
                <form id="partner-form" class="mb-4">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="partner-name" class="form-label">Nome do Parceiro</label>
                            <input type="text" class="form-control" id="partner-name" required>
                        </div>
                        <div class="col-md-6">
                            <label for="commission-percent" class="form-label">% Comissão</label>
                            <input type="number" class="form-control" id="commission-percent" min="1" max="100" required>
                        </div>
                        <div class="col-md-6">
                            <label for="registration-date" class="form-label">Data de Cadastro</label>
                            <input type="date" class="form-control" id="registration-date" required>
                        </div>
                        <div class="col-12">
                            <button type="submit" class="btn btn-primary">Cadastrar Parceiro</button>
                        </div>
                    </div>
                </form>
                
                <h4>Parceiros Cadastrados</h4>
                <div class="table-responsive">
                    <table id="partners-table" class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Comissão</th>
                                <th>Data Cadastro</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="partners-list">
                            <!-- Dados serão preenchidos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Aba de Contratos -->
            <div class="tab-pane fade" id="contracts" role="tabpanel">
                <h4>Registrar Contrato</h4>
                <form id="contract-form" class="mb-4">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label for="contract-number" class="form-label">Número do Contrato</label>
                            <input type="text" class="form-control" id="contract-number" required>
                        </div>
                        <div class="col-md-6">
                            <label for="selected-partner" class="form-label">Parceiro</label>
                            <select class="form-select" id="selected-partner" required>
                                <option value="">Selecione um parceiro</option>
                                <!-- Opções serão preenchidas via JavaScript -->
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="monthly-value" class="form-label">R$ Adesão + Mensalidade</label>
                            <input type="number" class="form-control" id="monthly-value" step="0.01" min="0" required>
                        </div>
                        <div class="col-md-6">
                            <label for="validation-date" class="form-label">Data de Validação</label>
                            <input type="date" class="form-control" id="validation-date" required>
                        </div>
                        <div class="col-md-6">
                            <label for="registered-by" class="form-label">Registrado por</label>
                            <input type="text" class="form-control" id="registered-by" readonly>
                        </div>
                        <div class="col-12">
                            <button type="submit" class="btn btn-primary">Registrar Contrato</button>
                        </div>
                    </div>
                </form>
                
                <h4>Contratos Registrados</h4>
                <div class="table-responsive">
                    <table id="contracts-table" class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Contrato</th>
                                <th>Parceiro</th>
                                <th>Adesão + Mensalidade</th>
                                <th>Comissão</th>
                                <th>Data</th>
                                <th>Registrado por</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="contracts-list">
                            <!-- Dados serão preenchidos via JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Aba de Relatórios -->
            <div class="tab-pane fade" id="reports" role="tabpanel">
                <h4>Gerar Relatório de Comissões</h4>
                <form id="report-form" class="mb-4">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label for="report-partner" class="form-label">Filtrar por Parceiro</label>
                            <select class="form-select" id="report-partner">
                                <option value="">Todos os parceiros</option>
                                <!-- Opções serão preenchidas via JavaScript -->
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="start-date" class="form-label">Data Inicial</label>
                            <input type="date" class="form-control" id="start-date">
                        </div>
                        <div class="col-md-4">
                            <label for="end-date" class="form-label">Data Final</label>
                            <input type="date" class="form-control" id="end-date">
                        </div>
                        <div class="col-12">
                            <button type="submit" class="btn btn-primary me-2">Gerar Relatório</button>
                            <button type="button" id="export-excel" class="btn btn-success">Exportar Excel</button>
                        </div>
                    </div>
                </form>
                
                <h4>Resultado do Relatório</h4>
                <div class="table-responsive">
                    <table id="report-table" class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Parceiro</th>
                                <th>Contrato</th>
                                <th>Adesão + Mensalidade</th>
                                <th>% Comissão</th>
                                <th>Comissão</th>
                                <th>Data</th>
                            </tr>
                        </thead>
                        <tbody id="report-results">
                            <!-- Dados serão preenchidos via JavaScript -->
                        </tbody>
                        <tfoot>
                            <tr class="total-row">
                                <td colspan="4" class="text-end"><strong>Total a Pagar:</strong></td>
                                <td colspan="2" id="total-commission"><strong>R$0,00</strong></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmação -->
    <div class="modal fade" id="confirm-modal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirm-modal-title">Confirmação</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="confirm-modal-body">
                    Tem certeza que deseja excluir este item?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" id="confirm-delete">Excluir</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script>
        // Inicialização do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyD4vkuVTM8P1k7qz6ZE88Is0ZhDoOhl8vE",
            authDomain: "cupons-5b5fd.firebaseapp.com",
            projectId: "cupons-5b5fd",
            storageBucket: "cupons-5b5fd.appspot.com",
            messagingSenderId: "40858719023",
            appId: "1:40858719023:web:659377d616ad90b68487da",
            databaseURL: "https://cupons-5b5fd-default-rtdb.firebaseio.com/"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // Variáveis globais
        let currentUser = null;
        let isAdmin = false;
        let itemToDelete = null;
        let deleteType = null;
        let lastReportData = null;
        let lastTotalCommission = 0;

        // Inicialização quando o DOM estiver pronto
        $(document).ready(function() {
            // Configurar data atual como padrão nos campos de data
            const today = new Date().toISOString().split('T')[0];
            $('#registration-date').val(today);
            $('#validation-date').val(today);

            // Verificar estado de autenticação
            auth.onAuthStateChanged(user => {
                if (user) {
                    // Usuário autenticado
                    currentUser = user;
                    
                    // Verificar se é admin
                    const adminEmails = ['bioranss@gmail.com', 'paulo@sejafibra.net', 'financeiro@sejafibra.net'];
                    isAdmin = adminEmails.includes(user.email);
                    
                    if (isAdmin) {
                        $('body').addClass('is-admin');
                        $('.admin-tab').show();
                        $('#partners-tab').addClass('active');
                        $('#partners').addClass('show active');
                        $('#contracts-tab').removeClass('active');
                        $('#contracts').removeClass('show active');
                    } else {
                        $('body').removeClass('is-admin');
                        $('.admin-tab').hide();
                        $('#contracts-tab').addClass('active');
                        $('#contracts').addClass('show active');
                        $('#partners-tab').removeClass('active');
                        $('#partners').removeClass('show active');
                    }
                    
                    $('#auth-container').hide();
                    $('#app-container').show();
                    $('#registered-by').val(user.email);
                    loadPartners();
                    loadContracts();
                    initDataTables();
                } else {
                    // Usuário não autenticado
                    $('#auth-container').show();
                    $('#app-container').hide();
                }
            });

            // Login
            $('#login-btn').click(function(e) {
                e.preventDefault();
                const email = $('#email').val();
                const password = $('#password').val();
                
                auth.signInWithEmailAndPassword(email, password)
                    .then(() => {
                        $('#login-message').text('');
                    })
                    .catch(error => {
                        $('#login-message').text('Erro no login: ' + error.message);
                    });
            });

            // Logout
            $('#logout-btn').click(function() {
                auth.signOut();
            });

            // Cadastrar Parceiro
            $('#partner-form').submit(function(e) {
                e.preventDefault();
                
                if (!isAdmin) {
                    alert('Você não tem acesso a esta funcionalidade.');
                    return;
                }
                
                // Ajustar a data para o formato YYYY-MM-DD (sem fuso horário)
                const registrationDate = $('#registration-date').val();
                
                const partnerData = {
                    name: $('#partner-name').val(),
                    commissionPercent: $('#commission-percent').val(),
                    date: registrationDate, // Já está no formato YYYY-MM-DD
                    createdBy: currentUser.email,
                    createdAt: firebase.database.ServerValue.TIMESTAMP
                };
                
                database.ref('partners').push(partnerData)
                    .then(() => {
                        alert('Parceiro cadastrado com sucesso!');
                        $('#partner-form')[0].reset();
                        $('#registration-date').val(today); // Reset para data atual
                        loadPartners();
                    })
                    .catch(error => {
                        alert('Erro ao cadastrar: ' + error.message);
                    });
            });

            // Registrar Contrato
            $('#contract-form').submit(function(e) {
                e.preventDefault();
                
                // Ajustar a data para o formato YYYY-MM-DD (sem fuso horário)
                const validationDate = $('#validation-date').val();
                
                const contractData = {
                    contractNumber: $('#contract-number').val(),
                    partnerId: $('#selected-partner').val(),
                    monthlyValue: $('#monthly-value').val(),
                    validationDate: validationDate, // Já está no formato YYYY-MM-DD
                    registeredBy: currentUser.email,
                    registeredAt: firebase.database.ServerValue.TIMESTAMP
                };
                
                database.ref('contracts').push(contractData)
                    .then(() => {
                        alert('Contrato registrado com sucesso!');
                        $('#contract-form')[0].reset();
                        $('#validation-date').val(today); // Reset para data atual
                        loadContracts();
                    })
                    .catch(error => {
                        alert('Erro ao registrar: ' + error.message);
                    });
            });

            // Gerar Relatório
            $('#report-form').submit(function(e) {
                e.preventDefault();
                generateReport();
            });

            // Exportar Excel
            $('#export-excel').click(function() {
                if (!lastReportData || lastReportData.length === 0) {
                    alert('Gere um relatório antes de exportar.');
                    return;
                }
                exportToExcel();
            });

            // Confirmar exclusão
            $('#confirm-delete').click(function() {
                if (deleteType === 'partner') {
                    if (!isAdmin) {
                        alert('Você não tem acesso a esta funcionalidade.');
                        $('#confirm-modal').modal('hide');
                        return;
                    }
                    
                    database.ref('partners/' + itemToDelete).remove()
                        .then(() => {
                            $('#confirm-modal').modal('hide');
                            loadPartners();
                        });
                } else if (deleteType === 'contract') {
                    database.ref('contracts/' + itemToDelete).remove()
                        .then(() => {
                            $('#confirm-modal').modal('hide');
                            loadContracts();
                        });
                }
            });

            // Controle de acesso às abas
            $('#myTab button').on('click', function(e) {
                const target = $(this).data('bsTarget');
                
                if (target === '#partners' && !isAdmin) {
                    e.preventDefault();
                    alert('Você não tem acesso à aba de Parceiros.');
                    $(this).removeClass('active');
                    $('#contracts-tab').addClass('active');
                    $('#contracts').addClass('show active');
                    return false;
                }
            });
        });

        // Carregar parceiros
        function loadPartners() {
            database.ref('partners').once('value')
                .then(snapshot => {
                    $('#partners-list').empty();
                    $('#selected-partner').empty().append('<option value="">Selecione um parceiro</option>');
                    $('#report-partner').empty().append('<option value="">Todos os parceiros</option>');
                    
                    snapshot.forEach(childSnapshot => {
                        const partner = childSnapshot.val();
                        const key = childSnapshot.key;
                        
                        // Adicionar à tabela de parceiros
                        $('#partners-list').append(`
                            <tr>
                                <td>${partner.name}</td>
                                <td>${partner.commissionPercent}%</td>
                                <td>${formatDate(partner.date)}</td>
                                <td>
                                    <button class="btn btn-sm btn-danger delete-partner" data-key="${key}">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `);
                        
                        // Adicionar às opções de parceiro
                        $('#selected-partner').append(`<option value="${key}">${partner.name}</option>`);
                        $('#report-partner').append(`<option value="${key}">${partner.name}</option>`);
                    });
                    
                    // Configurar eventos de exclusão
                    $('.delete-partner').click(function() {
                        if (!isAdmin) {
                            alert('Você não tem acesso a esta funcionalidade.');
                            return;
                        }
                        
                        itemToDelete = $(this).data('key');
                        deleteType = 'partner';
                        $('#confirm-modal-title').text('Excluir Parceiro');
                        $('#confirm-modal-body').html('Tem certeza que deseja excluir este parceiro?<br><strong>Esta ação não pode ser desfeita.</strong>');
                        $('#confirm-modal').modal('show');
                    });
                });
        }

        // Carregar contratos
        function loadContracts() {
            database.ref('contracts').once('value')
                .then(snapshot => {
                    $('#contracts-list').empty();
                    
                    snapshot.forEach(childSnapshot => {
                        const contract = childSnapshot.val();
                        const key = childSnapshot.key;
                        
                        // Buscar informações do parceiro
                        database.ref('partners/' + contract.partnerId).once('value')
                            .then(partnerSnapshot => {
                                const partner = partnerSnapshot.val();
                                let partnerName = 'Parceiro não encontrado';
                                let commissionPercent = 0;
                                let commissionValue = 0;
                                
                                if (partner) {
                                    partnerName = partner.name;
                                    commissionPercent = parseFloat(partner.commissionPercent);
                                    commissionValue = (parseFloat(contract.monthlyValue) * commissionPercent / 100).toFixed(2);
                                }
                                
                                // Adicionar à tabela de contratos
                                $('#contracts-list').append(`
                                    <tr>
                                        <td>${contract.contractNumber}</td>
                                        <td>${partnerName}</td>
                                        <td>R$${parseFloat(contract.monthlyValue).toFixed(2).replace('.', ',')}</td>
                                        <td>R$${commissionValue.replace('.', ',')} (${commissionPercent}%)</td>
                                        <td>${formatDate(contract.validationDate)}</td>
                                        <td>${contract.registeredBy}</td>
                                        <td>
                                            <button class="btn btn-sm btn-danger delete-contract" data-key="${key}">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </td>
                                    </tr>
                                `);
                                
                                // Configurar eventos de exclusão
                                $('.delete-contract').click(function() {
                                    itemToDelete = $(this).data('key');
                                    deleteType = 'contract';
                                    $('#confirm-modal-title').text('Excluir Registro de Contrato');
                                    $('#confirm-modal-body').html('Tem certeza que deseja excluir este registro de contrato?<br><strong>Esta ação não pode ser desfeita.</strong>');
                                    $('#confirm-modal').modal('show');
                                });
                            });
                    });
                });
        }

        // Gerar relatório
        function generateReport() {
            const partnerFilter = $('#report-partner').val();
            const startDate = $('#start-date').val();
            const endDate = $('#end-date').val();
            
            // Ajustar datas para o fuso horário do Brasil (UTC-3)
            let startDateObj = startDate ? new Date(startDate + 'T00:00:00-03:00') : null;
            let endDateObj = endDate ? new Date(endDate + 'T23:59:59-03:00') : null;
            
            database.ref('contracts').once('value')
                .then(snapshot => {
                    $('#report-results').empty();
                    let totalCommission = 0;
                    let reportData = [];
                    
                    const promises = [];
                    
                    snapshot.forEach(childSnapshot => {
                        const contract = childSnapshot.val();
                        const contractKey = childSnapshot.key;
                        
                        // Buscar informações do parceiro
                        const promise = database.ref('partners/' + contract.partnerId).once('value')
                            .then(partnerSnapshot => {
                                const partner = partnerSnapshot.val();
                                
                                // Aplicar filtros
                                if (partnerFilter && contract.partnerId !== partnerFilter) return;
                                
                                // Converter data para objeto Date com fuso horário do Brasil
                                const contractDate = new Date(contract.validationDate + 'T00:00:00-03:00');
                                
                                if (startDateObj && contractDate < startDateObj) return;
                                if (endDateObj && contractDate > endDateObj) return;
                                
                                let partnerName = 'Parceiro não encontrado';
                                let commissionPercent = 0;
                                let commissionValue = 0;
                                
                                if (partner) {
                                    partnerName = partner.name;
                                    commissionPercent = parseFloat(partner.commissionPercent);
                                    commissionValue = parseFloat(contract.monthlyValue) * commissionPercent / 100;
                                }
                                
                                totalCommission += commissionValue;
                                
                                // Adicionar aos resultados
                                $('#report-results').append(`
                                    <tr>
                                        <td>${partnerName}</td>
                                        <td>${contract.contractNumber}</td>
                                        <td>R$${parseFloat(contract.monthlyValue).toFixed(2).replace('.', ',')}</td>
                                        <td>${commissionPercent}%</td>
                                        <td>R$${commissionValue.toFixed(2).replace('.', ',')}</td>
                                        <td>${formatDate(contract.validationDate)}</td>
                                    </tr>
                                `);
                                
                                // Armazenar dados para exportação
                                reportData.push({
                                    Parceiro: partnerName,
                                    Contrato: contract.contractNumber,
                                    Mensalidade: 'R$' + parseFloat(contract.monthlyValue).toFixed(2).replace('.', ','),
                                    'Comissão %': commissionPercent + '%',
                                    Comissão: 'R$' + commissionValue.toFixed(2).replace('.', ','),
                                    Data: formatDate(contract.validationDate)
                                });
                            });
                        
                        promises.push(promise);
                    });
                    
                    Promise.all(promises).then(() => {
                        // Atualizar total
                        $('#total-commission').html(`<strong>R$${totalCommission.toFixed(2).replace('.', ',')}</strong>`);
                        
                        // Armazenar dados para exportação
                        lastReportData = reportData;
                        lastTotalCommission = totalCommission;
                        
                        if ($('#report-results').children().length === 0) {
                            $('#report-results').append('<tr><td colspan="6" class="text-center">Nenhum resultado encontrado com os filtros aplicados.</td></tr>');
                            $('#total-commission').html('<strong>R$0,00</strong>');
                        }
                    });
                });
        }

        // Exportar para Excel
        function exportToExcel() {
            // Adicionar linha de total
            const dataToExport = [...lastReportData];
            dataToExport.push({
                Parceiro: '',
                Contrato: '',
                Mensalidade: '',
                'Comissão %': 'Total a Pagar:',
                Comissão: 'R$' + lastTotalCommission.toFixed(2).replace('.', ','),
                Data: ''
            });
            
            // Criar planilha
            const ws = XLSX.utils.json_to_sheet(dataToExport);
            
            // Ajustar largura das colunas
            ws['!cols'] = [
                { wch: 30 }, // Parceiro
                { wch: 15 }, // Contrato
                { wch: 15 }, // Mensalidade
                { wch: 12 }, // Comissão %
                { wch: 12 }, // Comissão
                { wch: 12 }  // Data
            ];
            
            // Criar workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "Relatório");
            
            // Exportar
            XLSX.writeFile(wb, `Relatorio_Comissoes_${new Date().toISOString().slice(0,10)}.xlsx`);
        }

        // Inicializar DataTables
        function initDataTables() {
            $('#partners-table').DataTable({
                language: {
                    url: 'https://cdn.datatables.net/plug-ins/1.13.6/i18n/pt-BR.json'
                }
            });
            
            $('#contracts-table').DataTable({
                language: {
                    url: 'https://cdn.datatables.net/plug-ins/1.13.6/i18n/pt-BR.json'
                }
            });
            
            $('#report-table').DataTable({
                language: {
                    url: 'https://cdn.datatables.net/plug-ins/1.13.6/i18n/pt-BR.json'
                },
                searching: false,
                paging: false,
                info: false
            });
        }

        // Formatar data para exibição (DD/MM/YYYY)
        function formatDate(dateString) {
            if (!dateString) return '';
            
            // Se já estiver no formato DD/MM/YYYY (contém /)
            if (dateString.includes('/')) {
                return dateString;
            }
            
            // Se estiver no formato YYYY-MM-DD
            if (dateString.includes('-')) {
                const parts = dateString.split('-');
                if (parts.length === 3) {
                    return `${parts[2]}/${parts[1]}/${parts[0]}`;
                }
            }
            
            return dateString;
        }
    </script>
</body>
</html>
